# üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: Constructure

## üìä –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

```typescript
// –ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã
type UUID = string;
type Timestamp = Date;

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
interface User {
  id: UUID;
  email: string;
  name: string;
  avatar?: string;
  role: 'admin' | 'teacher' | 'student';
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

// –ö—É—Ä—Å
interface Course {
  id: UUID;
  title: string;
  description: string;
  thumbnail?: string;
  authorId: UUID;
  collaborators: UUID[];
  status: 'draft' | 'published' | 'archived';
  visibility: 'private' | 'public' | 'organization';
  tags: string[];
  metadata: CourseMetadata;
  graph: CourseGraph;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

// –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–∞
interface CourseMetadata {
  estimatedDuration: number; // –≤ –º–∏–Ω—É—Ç–∞—Ö
  difficulty: 'beginner' | 'intermediate' | 'advanced';
  language: string;
  version: string;
  prerequisites: string[];
}

// –ì—Ä–∞—Ñ –∫—É—Ä—Å–∞ - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
interface CourseGraph {
  nodes: Map<UUID, CourseNode>;
  edges: Map<UUID, CourseEdge>;
  layouts: Map<LayoutType, LayoutData>;
  metadata: GraphMetadata;
}

// –£–∑–µ–ª –∫—É—Ä—Å–∞ (–º–æ–¥—É–ª—å, —É—Ä–æ–∫, —Ç–µ—Å—Ç –∏ —Ç.–¥.)
interface CourseNode {
  id: UUID;
  type: NodeType;
  title: string;
  description?: string;
  content: NodeContent;
  config: NodeConfig;
  position: Position;
  size: Size;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

// –°–≤—è–∑—å –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
interface CourseEdge {
  id: UUID;
  sourceId: UUID;
  targetId: UUID;
  type: EdgeType;
  condition?: EdgeCondition;
  label?: string;
  style?: EdgeStyle;
}

// –¢–∏–ø—ã —É–∑–ª–æ–≤
type NodeType = 
  | 'module'      // –ú–æ–¥—É–ª—å (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞)
  | 'lesson'      // –£—Ä–æ–∫
  | 'video'       // –í–∏–¥–µ–æ
  | 'quiz'        // –¢–µ—Å—Ç/–∫–≤–∏–∑
  | 'assignment'  // –ó–∞–¥–∞–Ω–∏–µ
  | 'text'        // –¢–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
  | 'interactive' // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
  | 'checkpoint'  // –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞
  | 'branch'      // –í–µ—Ç–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏
  | 'start'       // –ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞
  | 'end';        // –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞

// –¢–∏–ø—ã —Å–≤—è–∑–µ–π
type EdgeType = 
  | 'sequence'    // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
  | 'conditional' // –£—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
  | 'optional'    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—É—Ç—å
  | 'prerequisite'// –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ
  | 'reference';  // –°—Å—ã–ª–∫–∞/—Ä–µ—Ñ–µ—Ä–µ–Ω—Å

// –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —É–∑–ª–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞)
type NodeContent = 
  | LessonContent
  | VideoContent
  | QuizContent
  | AssignmentContent
  | TextContent
  | InteractiveContent;

// –ö–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞
interface LessonContent {
  type: 'lesson';
  body: string; // Rich text/HTML
  attachments: Attachment[];
  resources: Resource[];
}

// –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∏–¥–µ–æ
interface VideoContent {
  type: 'video';
  videoUrl: string;
  duration: number;
  subtitles?: Subtitle[];
  chapters?: VideoChapter[];
}

// –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–µ—Å—Ç–∞
interface QuizContent {
  type: 'quiz';
  questions: Question[];
  settings: QuizSettings;
  scoring: ScoringConfig;
}

// –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–¥–∞–Ω–∏—è
interface AssignmentContent {
  type: 'assignment';
  instructions: string;
  submissionType: 'text' | 'file' | 'url' | 'code';
  rubric?: AssignmentRubric;
  dueDate?: Timestamp;
}

// –ü–æ–∑–∏—Ü–∏—è –∏ —Ä–∞–∑–º–µ—Ä –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
interface Position {
  x: number;
  y: number;
  z?: number; // –¥–ª—è 3D —Ä–µ–∂–∏–º–æ–≤
}

interface Size {
  width: number;
  height: number;
}

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∑–ª–∞
interface NodeConfig {
  isRequired: boolean;
  passingScore?: number;
  maxAttempts?: number;
  timeLimit?: number;
  allowSkip: boolean;
  showProgress: boolean;
}

// –£—Å–ª–æ–≤–∏–µ –¥–ª—è —Å–≤—è–∑–∏
interface EdgeCondition {
  type: 'score' | 'completion' | 'time' | 'custom';
  operator: '>' | '<' | '==' | '!=' | '>=' | '<=';
  value: number | string | boolean;
  expression?: string; // –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
}

// –¢–∏–ø—ã –º–∞–∫–µ—Ç–æ–≤
type LayoutType = 'tree' | 'lego' | 'mindmap' | 'flowchart';

// –î–∞–Ω–Ω—ã–µ –º–∞–∫–µ—Ç–∞
interface LayoutData {
  type: LayoutType;
  positions: Map<UUID, Position>;
  viewBox: ViewBox;
  zoom: number;
  settings: LayoutSettings;
}

interface ViewBox {
  x: number;
  y: number;
  width: number;
  height: number;
}

// –í–æ–ø—Ä–æ—Å –¥–ª—è —Ç–µ—Å—Ç–∞
interface Question {
  id: UUID;
  type: 'multiple-choice' | 'single-choice' | 'text' | 'true-false' | 'matching' | 'ordering';
  question: string;
  options?: string[];
  correctAnswer: string | string[] | number;
  explanation?: string;
  points: number;
  tags?: string[];
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞
interface QuizSettings {
  shuffleQuestions: boolean;
  shuffleOptions: boolean;
  showFeedback: boolean;
  allowReview: boolean;
  timeLimit?: number;
  maxAttempts: number;
}

// –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏
interface ScoringConfig {
  totalPoints: number;
  passingScore: number;
  showScore: boolean;
  weightedScoring: boolean;
}

// –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫ —É—Ä–æ–∫—É
interface Attachment {
  id: UUID;
  name: string;
  url: string;
  type: string;
  size: number;
}

// –†–µ—Å—É—Ä—Å
interface Resource {
  id: UUID;
  title: string;
  type: 'link' | 'document' | 'tool';
  url: string;
  description?: string;
}

// –°—É–±—Ç–∏—Ç—Ä—ã
interface Subtitle {
  language: string;
  url: string;
}

// –ì–ª–∞–≤–∞ –≤–∏–¥–µ–æ
interface VideoChapter {
  title: string;
  startTime: number;
  endTime: number;
}
```

---

## üîÑ API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```typescript
POST /api/auth/register
POST /api/auth/login
POST /api/auth/logout
POST /api/auth/refresh
GET  /api/auth/me
```

### –ö—É—Ä—Å—ã
```typescript
GET    /api/courses              // –°–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤
POST   /api/courses              // –°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å
GET    /api/courses/:id          // –ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å
PUT    /api/courses/:id          // –û–±–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å
DELETE /api/courses/:id          // –£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å
POST   /api/courses/:id/duplicate // –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å
GET    /api/courses/:id/export   // –≠–∫—Å–ø–æ—Ä—Ç –∫—É—Ä—Å–∞
POST   /api/courses/import       // –ò–º–ø–æ—Ä—Ç –∫—É—Ä—Å–∞
```

### –£–∑–ª—ã –∫—É—Ä—Å–∞
```typescript
GET    /api/courses/:courseId/nodes     // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É–∑–ª—ã
POST   /api/courses/:courseId/nodes     // –°–æ–∑–¥–∞—Ç—å —É–∑–µ–ª
PUT    /api/courses/:courseId/nodes/:id // –û–±–Ω–æ–≤–∏—Ç—å —É–∑–µ–ª
DELETE /api/courses/:courseId/nodes/:id // –£–¥–∞–ª–∏—Ç—å —É–∑–µ–ª
```

### –°–≤—è–∑–∏
```typescript
GET    /api/courses/:courseId/edges     // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–≤—è–∑–∏
POST   /api/courses/:courseId/edges     // –°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å
PUT    /api/courses/:courseId/edges/:id // –û–±–Ω–æ–≤–∏—Ç—å —Å–≤—è–∑—å
DELETE /api/courses/:courseId/edges/:id // –£–¥–∞–ª–∏—Ç—å —Å–≤—è–∑—å
```

### –ú–∞–∫–µ—Ç—ã
```typescript
GET /api/courses/:courseId/layouts/:type // –ü–æ–ª—É—á–∏—Ç—å –º–∞–∫–µ—Ç
PUT /api/courses/:courseId/layouts/:type // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–∞–∫–µ—Ç
```

### –°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞
```typescript
GET  /api/courses/:courseId/collaborators     // –°–ø–∏—Å–æ–∫ —Å–æ–∞–≤—Ç–æ—Ä–æ–≤
POST /api/courses/:courseId/collaborators     // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∞–≤—Ç–æ—Ä–∞
PUT  /api/courses/:courseId/collaborators/:id // –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞
DELETE /api/courses/:courseId/collaborators/:id // –£–¥–∞–ª–∏—Ç—å —Å–æ–∞–≤—Ç–æ—Ä–∞
```

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
```typescript
GET    /api/courses/:courseId/comments          // –í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
POST   /api/courses/:courseId/comments          // –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
PUT    /api/courses/:courseId/comments/:id      // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
DELETE /api/courses/:courseId/comments/:id      // –£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
POST   /api/courses/:courseId/comments/:id/reply // –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
```

### –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã
```typescript
POST /api/media/upload    // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
GET  /api/media/:id       // –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª
DELETE /api/media/:id     // –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª
```

---

## üîó WebSocket Events

### –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```typescript
// –ö–ª–∏–µ–Ω—Ç -> –°–µ—Ä–≤–µ—Ä
interface WSClientEvents {
  'join-course': { courseId: string };
  'leave-course': { courseId: string };
  'node-update': { courseId: string; nodeId: string; changes: Partial<CourseNode> };
  'edge-update': { courseId: string; edgeId: string; changes: Partial<CourseEdge> };
  'layout-update': { courseId: string; layoutType: LayoutType; changes: Partial<LayoutData> };
  'cursor-move': { courseId: string; position: Position };
  'selection-change': { courseId: string; selectedIds: string[] };
}

// –°–µ—Ä–≤–µ—Ä -> –ö–ª–∏–µ–Ω—Ç
interface WSServerEvents {
  'user-joined': { user: User };
  'user-left': { userId: string };
  'node-updated': { nodeId: string; changes: Partial<CourseNode>; author: User };
  'edge-updated': { edgeId: string; changes: Partial<CourseEdge>; author: User };
  'layout-updated': { layoutType: LayoutType; changes: Partial<LayoutData>; author: User };
  'cursor-moved': { userId: string; position: Position };
  'selection-changed': { userId: string; selectedIds: string[] };
  'conflict-detected': { conflictId: string; details: ConflictDetails };
}
```

---

## üèóÔ∏è Frontend Architecture

### State Management (Zustand)
```typescript
// –ì–ª–∞–≤–Ω—ã–π —Å—Ç–æ—Ä
interface AppStore {
  // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  user: User | null;
  isAuthenticated: boolean;
  
  // –¢–µ–∫—É—â–∏–π –∫—É—Ä—Å
  currentCourse: Course | null;
  isLoading: boolean;
  
  // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  currentLayout: LayoutType;
  selectedNodes: Set<UUID>;
  selectedEdges: Set<UUID>;
  
  // UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  sidebarOpen: boolean;
  propertiesPanelOpen: boolean;
  
  // –î–µ–π—Å—Ç–≤–∏—è
  actions: {
    // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    login: (credentials: LoginCredentials) => Promise<void>;
    logout: () => void;
    
    // –ö—É—Ä—Å—ã
    loadCourse: (courseId: UUID) => Promise<void>;
    saveCourse: () => Promise<void>;
    
    // –£–∑–ª—ã
    addNode: (node: Partial<CourseNode>) => void;
    updateNode: (nodeId: UUID, changes: Partial<CourseNode>) => void;
    deleteNode: (nodeId: UUID) => void;
    
    // –°–≤—è–∑–∏
    addEdge: (edge: Partial<CourseEdge>) => void;
    updateEdge: (edgeId: UUID, changes: Partial<CourseEdge>) => void;
    deleteEdge: (edgeId: UUID) => void;
    
    // –ú–∞–∫–µ—Ç—ã
    switchLayout: (layoutType: LayoutType) => void;
    updateLayout: (changes: Partial<LayoutData>) => void;
    
    // –í—ã–¥–µ–ª–µ–Ω–∏–µ
    selectNode: (nodeId: UUID, multi?: boolean) => void;
    selectEdge: (edgeId: UUID, multi?: boolean) => void;
    clearSelection: () => void;
  };
}
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/                 # –ë–∞–∑–æ–≤—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Input/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Modal/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Tooltip/
‚îÇ   ‚îú‚îÄ‚îÄ layout/             # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–∞–∫–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PropertiesPanel/
‚îÇ   ‚îú‚îÄ‚îÄ course/             # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫—É—Ä—Å–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CourseCard/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CourseList/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CourseSettings/
‚îÇ   ‚îú‚îÄ‚îÄ editor/             # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Canvas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Toolbar/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NodePalette/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PropertiesEditor/
‚îÇ   ‚îú‚îÄ‚îÄ nodes/              # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É–∑–ª–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BaseNode/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonNode/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VideoNode/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QuizNode/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AssignmentNode/
‚îÇ   ‚îî‚îÄ‚îÄ visualizations/     # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ       ‚îú‚îÄ‚îÄ TreeLayout/
‚îÇ       ‚îú‚îÄ‚îÄ LegoLayout/
‚îÇ       ‚îú‚îÄ‚îÄ MindmapLayout/
‚îÇ       ‚îî‚îÄ‚îÄ FlowchartLayout/
‚îú‚îÄ‚îÄ hooks/                  # Custom React hooks
‚îú‚îÄ‚îÄ stores/                 # Zustand stores
‚îú‚îÄ‚îÄ services/               # API —Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ utils/                  # –£—Ç–∏–ª–∏—Ç—ã
‚îî‚îÄ‚îÄ types/                  # TypeScript —Ç–∏–ø—ã
```

---

## üîß –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### Docker Compose
```yaml
version: '3.8'
services:
  web:
    build: ./apps/web
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_URL=http://api:3001
    depends_on:
      - api

  api:
    build: ./apps/api
    ports:
      - "3001:3001"
    environment:
      - DATABASE_URL=postgresql://postgres:password@db:5432/constructure
      - JWT_SECRET=your-secret-key
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis

  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=constructure
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  postgres_data:
```

### Prisma Schema
```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  avatar    String?
  role      Role     @default(TEACHER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // –û—Ç–Ω–æ—à–µ–Ω–∏—è
  courses       Course[] @relation("CourseAuthor")
  collaborations Collaboration[]
  comments      Comment[]

  @@map("users")
}

model Course {
  id          String       @id @default(cuid())
  title       String
  description String?
  thumbnail   String?
  status      CourseStatus @default(DRAFT)
  visibility  Visibility   @default(PRIVATE)
  tags        String[]
  metadata    Json?
  graph       Json         // –ì—Ä–∞—Ñ –∫—É—Ä—Å–∞ –≤ JSON
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // –û—Ç–Ω–æ—à–µ–Ω–∏—è
  authorId        String
  author          User            @relation("CourseAuthor", fields: [authorId], references: [id])
  collaborations  Collaboration[]
  comments        Comment[]

  @@map("courses")
}

model Collaboration {
  id        String           @id @default(cuid())
  role      CollaboratorRole @default(EDITOR)
  createdAt DateTime         @default(now())

  // –û—Ç–Ω–æ—à–µ–Ω–∏—è
  userId   String
  user     User   @relation(fields: [userId], references: [id])
  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  @@unique([userId, courseId])
  @@map("collaborations")
}

model Comment {
  id        String    @id @default(cuid())
  content   String
  nodeId    String?   // –ö –∫–∞–∫–æ–º—É —É–∑–ª—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  position  Json?     // –ü–æ–∑–∏—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –Ω–∞ canvas
  resolved  Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // –û—Ç–Ω–æ—à–µ–Ω–∏—è
  authorId  String
  author    User      @relation(fields: [authorId], references: [id])
  courseId  String
  course    Course    @relation(fields: [courseId], references: [id])
  parentId  String?
  parent    Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies   Comment[] @relation("CommentReplies")

  @@map("comments")
}

// Enums
enum Role {
  ADMIN
  TEACHER
  STUDENT
}

enum CourseStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum Visibility {
  PRIVATE
  PUBLIC
  ORGANIZATION
}

enum CollaboratorRole {
  VIEWER
  EDITOR
  ADMIN
}
```

---

## üöÄ Production Deployment

### Environment Variables
```bash
# Frontend (.env)
REACT_APP_API_URL=https://api.constructure.app
REACT_APP_WS_URL=wss://api.constructure.app
REACT_APP_CLOUDINARY_CLOUD_NAME=your-cloud
REACT_APP_SENTRY_DSN=https://your-sentry-dsn

# Backend (.env)
DATABASE_URL=postgresql://user:pass@db:5432/constructure
REDIS_URL=redis://redis:6379
JWT_SECRET=your-super-secret-key
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret
SENTRY_DSN=https://your-sentry-dsn
NODE_ENV=production
PORT=3001
```

### Nginx Configuration
```nginx
upstream api {
    server api:3001;
}

server {
    listen 80;
    server_name constructure.app www.constructure.app;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name constructure.app www.constructure.app;

    # SSL configuration
    ssl_certificate /etc/ssl/certs/constructure.crt;
    ssl_certificate_key /etc/ssl/private/constructure.key;

    # Frontend
    location / {
        root /var/www/constructure;
        try_files $uri $uri/ /index.html;
        
        # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }

    # API
    location /api/ {
        proxy_pass http://api;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # WebSocket
    location /socket.io/ {
        proxy_pass http://api;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
``` 